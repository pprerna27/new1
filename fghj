import win32com.client as win32
import openpyxl
import os

# ==== CONFIGURATION ====
WORKBOOK_PATH = "recipients.xlsx"   # Workbook with multiple sheets
ATTACHMENT_PATH = "report.xlsx"     # File to attach
FIXED_SUBJECT = "Status Update for Category"
FIXED_BODY = """Hello Team,

Please find attached the latest report.

Regards,
Your Name
"""
# =======================

def send_mail(to_list, cc_list, subject, body, attachment):
    outlook = win32.Dispatch("Outlook.Application")
    mail = outlook.CreateItem(0)

    mail.To = "; ".join(to_list)
    if cc_list:
        mail.CC = "; ".join(cc_list)
    mail.Subject = subject
    mail.Body = body

    # Add attachment if file exists
    if attachment and os.path.exists(attachment):
        mail.Attachments.Add(os.path.abspath(attachment))

    mail.Send()
    print(f"âœ… Sent mail: {subject}")


def main():
    wb = openpyxl.load_workbook(WORKBOOK_PATH)

    for sheet_name in wb.sheetnames:
        sheet = wb[sheet_name]

        # Assuming "To" emails in column A, "CC" emails in column B
        to_list = [cell.value for cell in sheet["A"] if cell.value]
        cc_list = [cell.value for cell in sheet["B"] if cell.value]

        subject = f"{FIXED_SUBJECT} - {sheet_name}"
        print(f"Preparing mail for sheet: {sheet_name}")

        send_mail(to_list, cc_list, subject, FIXED_BODY, ATTACHMENT_PATH)


if __name__ == "__main__":
    main()